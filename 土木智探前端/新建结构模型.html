<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>结构模型界面</title>
    <style>
        body {
            text-align: center;
            background-image: url("background.png");
            background-size: cover;
            /* 设置背景满铺 */
            background-attachment: fixed;
            margin: 0; /* 清除默认的外边距，保证全屏显示 */
            overflow: hidden; /* 防止滚动条出现 */
        }

        #canvas-container {
            width: 100%;
            height: 100vh; /* 设置容器高度为视窗高度 */
        }
    </style>
</head>

<body>
    <img src="同济大学背景题头.png" style="width: 100%; object-position: center;">

    <h1 class="white">1.结构模型输入与编辑</h1>

    <h1>新建结构模型</h1>

    <form id="modelForm">
        <label>输入模型尺寸（长, 宽, 高）：</label>
        <input type="text" id="dimensions" name="dimensions" placeholder="长度,宽度,高度"><br><br>

        <button type="button" onclick="createModel()">新建模型</button>
        <button type="button" onclick="uploadModel()">上传模型</button>
    </form>

    <div id="canvas-container"></div> <!-- 用于容纳 Three.js 的 canvas 元素 -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/orbit-controls-es6/1.3.0/OrbitControls.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/OBJLoader/2.0.0/OBJLoader.js"></script>

    <script>
        // 初始化 Three.js 相关变量
        let scene, camera, renderer, controls, currentModel;

        // 初始化场景、相机、渲染器等
        function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer();
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.getElementById("canvas-container").appendChild(renderer.domElement);

            // 添加控制器，允许用户进行旋转、平移等操作
            controls = new THREE.OrbitControls(camera, renderer.domElement);

            animate(); // 开始渲染循环
        }

        // 渲染循环
        function animate() {
            requestAnimationFrame(animate);
            controls.update(); // 更新控制器状态
            renderer.render(scene, camera);
        }

        // 创建模型
        function createModel() {
            clearScene(); // 清除场景中的模型

            const dimensions = document.getElementById('dimensions').value.split(',').map(parseFloat);
            const length = dimensions[0];
            const width = dimensions[1];
            const height = dimensions[2];

            const geometry = new THREE.BoxGeometry(length, width, height);
            const material = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
            currentModel = new THREE.Mesh(geometry, material);
            scene.add(currentModel);

            // 设置相机位置，使模型位于相机的可视范围内
            camera.position.z = Math.max(length, width, height) * 2;
        }

        // 上传模型
        function uploadModel() {
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
           
            fileInput.onchange = function() {
                const file = this.files[0];
                const reader = new FileReader();
                reader.onload = function(event) {
                    const contents = event.target.result;
                    loadModel(contents);
                };
                reader.readAsText(file);
            };
            fileInput.click();
        }

        // 加载上传的模型
        function loadModel(contents) {
            clearScene(); // 清除场景中的模型

            // 解析模型数据并创建模型
            const loader = new THREE.OBJLoader();
            const object = loader.parse(contents);
            currentModel = object.children[0];
            scene.add(currentModel);
        }

        // 清除场景中的模型
        function clearScene() {
            if (currentModel) {
                scene.remove(currentModel);
                currentModel.geometry.dispose();
                currentModel.material.dispose();
                currentModel = null;
            }
        }

        // 页面加载完成后执行初始化操作
        window.onload = init;
    </script>
</body>
</html>
