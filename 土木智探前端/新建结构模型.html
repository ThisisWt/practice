<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>结构模型界面</title>
    <style>
        body {
            text-align: center;
            background-image: url("background.png");
            background-size: cover;
            background-attachment: fixed;
            margin: 0;
            overflow: hidden;
        }

        #canvas-container {
            width: 100%;
            height: 100vh;
        }
    </style>
</head>

<body>
    <img src="同济大学背景题头.png" style="width: 100%; object-position: center;">

    <h1 class="white">1.结构模型输入与编辑</h1>

    <h1>新建结构模型</h1>

    <form id="modelForm">
        <label>输入模型尺寸（长, 宽, 高）：</label>
        <input type="text" id="dimensions" name="dimensions" placeholder="长度,宽度,高度"><br><br>

        <button type="button" onclick="createModel()">新建模型</button>
        <button type="button" onclick="uploadModel()">上传模型</button>
    </form>

    <div id="canvas-container"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/OBJLoader/2.0.0/OBJLoader.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/orbit-controls-es6/1.3.0/OrbitControls.js"></script>

    <script>
        let scene, camera, renderer, controls, currentModel;

        function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer();
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.getElementById("canvas-container").appendChild(renderer.domElement);

            controls = new THREE.OrbitControls(camera, renderer.domElement);

            animate();
        }

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }

        function createModel() {
            clearScene();

            const dimensions = document.getElementById('dimensions').value.split(',').map(parseFloat);
            const length = dimensions[0];
            const width = dimensions[1];
            const height = dimensions[2];

            const data = {
                length: length,
                width: width,
                height: height
            };

            fetch('http://localhost:5000/create_model', { // 修改为后端地址
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                console.log(data);
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }

        function uploadModel() {
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
           
            fileInput.onchange = function() {
                const file = this.files[0];
                const formData = new FormData();
                formData.append('file', file);

                fetch('http://localhost:5000/upload_model', { // 修改为后端地址
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    console.log(data);
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            };
            fileInput.click();
        }

        function loadModel(contents) {
            clearScene();

            const loader = new THREE.OBJLoader();
            const object = loader.parse(contents);
            currentModel = object.children[0];
            scene.add(currentModel);
        }

        function clearScene() {
            if (currentModel) {
                scene.remove(currentModel);
                currentModel.geometry.dispose();
                currentModel.material.dispose();
                currentModel = null;
            }
        }

        window.onload = init;
    </script>
</body>
</html>
